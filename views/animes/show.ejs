<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/animes/show.css">
<%- include('../partials/nav') %>

<main>
  <div class="show-content">
    <img 
      src="<%= anime.imageURL %>" 
      alt="<%= anime.title %>'s cover image"
      class="anime-image"
    >
    <div class="title-section">
      <div class="anime-title"><%= anime.title %></div>
      <div>Rating: <%= anime.rating %> </div>
    </div>
    <div class="2nd-section">
      <!-- <div>Studio</div> -->
      <div><%= anime.ongoing ? 'Ongoing' : 'Completed' %> </div>
    </div>
    <div class="3rd-section">Released: <%= anime.releaseYear.getFullYear()+1%> </div>
    <div class="4nd-section">Genre: <%= anime.genre %></div>
    
    <!-- insert cast -->

    <div class="review-header">
      <div class="review-title">Reviews</div>
      <% if (user) { %>
        <button popovertarget="review-popup" class="review-button">Add Review</button>
        <div popover="manual" id="review-popup">
          <form 
            id="add-review-form"
            action="catalog/<%= anime._id %>/reviews"
            method="POST"
          >
            <div class="">
              <input type="text" placeholder="Headline" class="headline-input">
              <input type="number" placeholder="rating" class="rating-input">
            </div>
            <textarea name="content" id="content-textarea" placeholder="Write review here"></textarea>
            <button type="submit"> Add</button>
          </form>
          <button class="cancel-button">‚ùå</button>
        </div>
      <% } %>
    </div>

    <div class="review-container"> 
      <% if (!anime.reviews.length) { %>
        <h2>No Reviews</h2>
      <% } else { %>
        <% anime.reviews.forEach(review => { %>
          <div class="review">
            <div class="review-headline"><% review.reviewTitle %></div>
            <div class="review-body">
              <p class="review-text"><% review.content %></p>
              <div class="review-rating"><% review.rating %></div>
            </div>          
            <div class="username"><% review.user %></div>
          </div>
        <% }) %>
      <% } %>
    </div>
  </div>
</main>

<%- include('../partials/footer') %>